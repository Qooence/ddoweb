<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/base :: common_base(~{::title},~{::link},~{},~{::script})">
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>登录</title>
    <link th:href="@{/css/app.min.1.css}" rel="stylesheet">
    <link th:href="@{/css/login.css}" rel="stylesheet">
    <link th:href="@{/plugins/iCheck/all.css}" rel="stylesheet">
    <script th:src="@{/plugins/iCheck/icheck.min.js}" type="text/javascript"></script>
    <script th:src="@{/js/MD5.js}" type="text/javascript"></script>
</head>

<body class="gray-bg login-content">
<div class="lc-block animated flipInX" id="l-login">
    <h3 class="text-center">欢迎使用XXXX后台管理系统</h3>
    <form class="login" method="post" action="#">
        <div class="input-group msg-error m-b-10">
            <div class=""><i class="fa fa-minus-circle"></i><span>请输入账户名和密码</span></div>
        </div>
        <div class="input-group m-b-20">
            <label class="input-group-addon"><i class="fa fa-user"></i></label>
            <div class="fg-line">
                <input type="text" name="username" id="username" class="form-control" placeholder="用户名">
            </div>
        </div>
        <div class="input-group m-b-10">
            <label class="input-group-addon"><i class="fa fa-lock"></i></label>
            <div class="fg-line">
                <input type="password" name="password" id="password" class="form-control" placeholder=" 密码">
            </div>
        </div>
        <div class="login-nav">
            <input type="checkbox" name="rememberMe" id=rememberMe class="checkbox i-checks">
                <span class="remember">记住我</span>
            </input>
        </div>
        <div>
            <button type="button" class="btn btn-block btn-lg btn-primary">登录</button>
        </div>
    </form>
</div>
<script>
    $(document).ready(function () {
        Waves.attach('.btn:not(.btn-icon):not(.btn-float)');
        Waves.attach('.btn-icon, .btn-float', ['waves-circle', 'waves-float']);
        Waves.init();

        if ($('.fg-line')[0]) {
            $('body').on('focus', '.form-control', function () {
                $(this).closest('.fg-line').addClass('fg-toggled');
            })

            $('body').on('blur', '.form-control', function () {
                var p = $(this).closest('.form-group');
                var i = p.find('.form-control').val();

                if (p.hasClass('fg-float')) {
                    if (i.length == 0) {
                        $(this).closest('.fg-line').removeClass('fg-toggled');
                    }
                } else {
                    $(this).closest('.fg-line').removeClass('fg-toggled');
                }
            });
        }
        if ($('.fg-float')[0]) {
            $('.fg-float .form-control').each(function () {
                var i = $(this).val();
                if (!i.length == 0) {
                    $(this).closest('.fg-line').addClass('fg-toggled');
                }
            });
        }
        $('.i-checks').iCheck({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green'
        });
        $('.login').on("click", function (e) {
            console.log("dianjile");
            if ($("#username").val() == "" || $("#password").val() == "") {
                $('.msg-error span').html("用户名或密码不能为空");
                $('.msg-error div').show();
                return;
            }else {
                $('.msg-error div').hide();
            }
            TOOLS.loadingProgress("show");
            e.preventDefault();
            $('button[type="submit"]').attr('disabled', true);
            $('button[type="submit"]').text('登陆中...');
            if ($('input[name="password"]').val() != '') {
                $('input[name="password"]').val($("#password").val());
            }
            var reqData = {
                username: $("#username").val(),
                password: $("#password").val(),
                rememberMe: $("#rememberMe").is(':checked')
            };
            TOOLS.doPost(reqData, 'http://localhost:18080/dologin', function (msg) {
                TOOLS.loadingProgress("hide");
                if (msg.status == 0) {
                    setTimeout(function () {
                        window.location.href = msg.data;
                    }, 1000);
                } else {
                    $('input[name="password"]').val('');
                    $('button[type="submit"]').attr('disabled', false);
                    $('button[type="submit"]').text('登陆');
                    $('.msg-error span').html(msg.message);
                    $('.msg-error div').show();
                    setTimeout(function () {
                        $('.msg-error div').hide();
                    }, 2500);
                }
            }, function (err) {
                TOOLS.loadingProgress("hide");
                $('input[name="password"]').val('');
                $('button[type="submit"]').attr('disabled', false);
                $('button[type="submit"]').text('登陆');
            })
        });
    });
</script>
</body>
</html>
